!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n(e.resourceLoader={})}(this,function(exports){"use strict";var __assign=function(){return(__assign=Object.assign||function(e){for(var n,t=1,r=arguments.length;t<r;t++)for(var o in n=arguments[t])Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o]);return e}).apply(this,arguments)};"function"!=typeof Object.assign&&Object.defineProperty(Object,"assign",{value:function(e,n){if(null===e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),r=1;r<arguments.length;r++){var o=arguments[r];if(null!==o)for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(t[i]=o[i])}return t},writable:!0,configurable:!0});var EVENTS={RESOURCE_LOADED:"RESOURCE_LOADED",COMPONENT_READY:"COMPONENT_READY"},getResourceElements=function(e){return void 0===e&&(e=document),[].slice.call(e.querySelectorAll("[data-resources]"))},pipe=function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return function(e){return n.reduce(function(e,n){return n(e)},e)}},curry=function(t){return function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];if(0===e.length)throw Error("EMPTY INVOCATION");return e.length>=t.length?t.apply(void 0,e):curry(t.bind.apply(t,[null].concat(e)))}},defaultTo=function(e,n){return n||e},defaultTo$1=curry(defaultTo),prop=function(e,n){return n[e]},prop$1=curry(prop),getDataResourceFromElement=pipe(defaultTo$1(document.createElement("div")),prop$1("dataset"),prop$1("resources"),defaultTo$1("")),getComponentQueueFromElement=function(element){void 0===element&&(element=document.createElement("div"));var dataResources=getDataResourceFromElement(element),definitions=eval(dataResources)||[];return definitions.map(function(e){return __assign({},e,{element:element})})},unnest=function(e){return[].concat.apply([],e)},getContentDefinitionsFromDOM=function(e){void 0===e&&(e=document);var n=getResourceElements(e);return unnest(n.map(getComponentQueueFromElement))},unique=function(e){return e.filter(function(e,n,t){return t.indexOf(e)===n})},mergeResources=function(t){return void 0===t&&(t=[]),t.reduce(function(e,n){return-1!==e.map(function(e){return e.path}).indexOf(n.path)?e:e.concat([__assign({},n,{dependencyPaths:unique(unnest(t.filter(function(e){return e.path===n.path}).map(function(e){return e.dependencyPaths||[]}))),elements:unique(unnest(t.filter(function(e){return e.path===n.path}).map(function(e){return e.elements||[]})))})])},[])},resolveBaseWith=function(e,n){return"##"!==n.substring(0,2)?n:e[n]||""},resolveBaseWith$1=curry(resolveBaseWith),isAbsolute=function(e){return new RegExp("^(?:[a-z]+:)?//","i").test(e)},isRootPath=function(e){return 0===e.indexOf("/")&&0!==e.indexOf("//")},getTrailingSlashesRegex=function(){return/\/?$/},getLeadingSlashesRegex=function(){return/^\/?/},replace=function(e,n,t){return t.replace(e,n)},replace$1=curry(replace),ensureTrailingSlash=replace$1(getTrailingSlashesRegex(),"/"),ensureNoLeadingSlash=replace$1(getLeadingSlashesRegex(),""),identity=function(e){return e},concat=function(e,n){return e+n},concat$1=curry(concat),always=function(){return!0},max=function(e,n){return e<n?n:e},_arity=function(e,d){switch(e){case 0:return function(){return d.apply(this,arguments)};case 1:return function(e){return d.apply(this,arguments)};case 2:return function(e,n){return d.apply(this,arguments)};case 3:return function(e,n,t){return d.apply(this,arguments)};case 4:return function(e,n,t,r){return d.apply(this,arguments)};case 5:return function(e,n,t,r,o){return d.apply(this,arguments)};case 6:return function(e,n,t,r,o,i){return d.apply(this,arguments)};case 7:return function(e,n,t,r,o,i,s){return d.apply(this,arguments)};case 8:return function(e,n,t,r,o,i,s,u){return d.apply(this,arguments)};case 9:return function(e,n,t,r,o,i,s,u,a){return d.apply(this,arguments)};case 10:return function(e,n,t,r,o,i,s,u,a,c){return d.apply(this,arguments)};default:throw new Error("First argument to _arity must be a non-negative integer no greater than ten")}},cond=function(n){var e=n.map(function(e){return e[0].length}).reduce(max,0);return _arity(e,function(){for(var e=0;e<n.length;){if(n[e][0].apply(this,arguments))return n[e][1].apply(this,arguments);e+=1}})},cond$1=curry(cond),defaultToEmptyString=defaultTo$1(""),ensureAbsolutePath=function(e){return cond$1([[isAbsolute,identity],[isRootPath,pipe(ensureNoLeadingSlash,concat$1(ensureTrailingSlash(e.origin)))],[always,pipe(ensureNoLeadingSlash,concat$1(ensureTrailingSlash(e.href)))]])},createEnsureAbsolutePath=function(e){return pipe(defaultToEmptyString,ensureAbsolutePath(e))},isRelative=function(e){return!isAbsolute(e)},normalizePath=function(e,n,t){if(void 0===e&&(e=""),n&&t&&isRelative(e)){if(n.base){var r=resolveBaseWith$1(t.baseMap);return(o=createEnsureAbsolutePath(window.location))(ensureTrailingSlash(r(n.base))+e)}if(t.base){var o=createEnsureAbsolutePath(window.location);return isRootPath(e)?o(e):o(ensureTrailingSlash(t.base)+e)}}return e},toResources=function(n,t){if(!t)return[];var e=t.paths.map(function(e){return{path:normalizePath(e,t,n),dependencyPaths:(t.dependsOn?t.dependsOn:[]).map(function(e){return normalizePath(e,t,n)}),elements:[t.element]}}),r=(t.dependsOn?t.dependsOn:[]).map(function(e){return{path:normalizePath(e,t,n),dependencyPaths:[],elements:[t.element]}});return e.concat(r)},toResources$1=curry(toResources),getResourcesFromContainer=function(e,n){var t=getContentDefinitionsFromDOM(n);return mergeResources(unnest(t.map(toResources$1(e))))},getResourcesFromContainer$1=curry(getResourcesFromContainer),loadResource=function(t){return fetch(t.path).then(function(e){var n=new CustomEvent(EVENTS.RESOURCE_LOADED,{detail:{resource:t,response:e}});document.dispatchEvent(n)})},loadResources=function(e){return e.map(loadResource)},getResourceByPath=function(e,n){return e.find(function(e){return e.path===n})},checkIfResolvable=function(n){return void 0===n&&(n=[]),n.every(function(e){return e.dependencyPaths.every(function(e){return!!getResourceByPath(n,e)})})},getReadyResources=function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=[]),e.filter(function(e){return e.dependencyPaths.every(function(n){return t.some(function(e){return e.path===n})})})},isCss=function(e){return-1<e.resource.path.indexOf(".css")},onCssLoaded=function(e){var n=document.createElement("link");n.rel="stylesheet",n.href=e.resource.path,document.body.append(n)},cssHandler={match:isCss,handle:onCssLoaded},isJs=function(e){return-1<e.resource.path.indexOf(".js")},onJsLoaded=function(e){var n=document.createElement("script");n.src=e.resource.path,n.async=!0,document.body.append(n)},jsHandler={match:isJs,handle:onJsLoaded},isEmpty=function(e){return 0===e.length};function _Set(){this._nativeSet="function"==typeof Set?new Set:null,this._items={}}function hasOrAdd(e,n,t){var r=typeof e;switch(r){case"undefined":return!!t._items[r]||(n&&(t._items[r]=!0),!1);case"object":if(null===e)return!!t._items.null||(n&&(t._items.null=!0),!1);default:return(r=Object.prototype.toString.call(e))in t._items?-1!==t._items[r].indexOf(e)||(n&&t._items[r].push(e),!1):(n&&(t._items[r]=[e]),!1)}}_Set.prototype.add=function(e){return!hasOrAdd(e,!0,this)},_Set.prototype.has=function(e){return hasOrAdd(e,!1,this)};var difference=function(e,n){for(var t=[],r=0,o=e.length,i=n.length,s=new _Set,u=0;u<i;u++)s.add(n[u]);for(;r<o;)s.add(e[r])&&(t[t.length]=e[r]),r+=1;return t},difference$1=curry(difference),remove=function(e,n,t){return t.slice().splice(e,n)},remove$1=curry(remove),ResourceLoader=function(){function e(e){this.options=null,this.pendingResources=[],this.loadedResources=[],this.defaultOptions={readyEvent:"resourcesReady",handler:[cssHandler,jsHandler]},this.options=__assign({container:this.defaultContainer},this.defaultOptions,e),this.bindEvents(),this.init(this.options)}return Object.defineProperty(e.prototype,"defaultContainer",{get:function(){return document.querySelector("body")},enumerable:!0,configurable:!0}),e.prototype.init=function(e){this.waitingResources=getResourcesFromContainer$1(e,e.container).slice(),checkIfResolvable(this.waitingResources),this.pendingResources=this.pendingResources.concat(getReadyResources(this.waitingResources,this.loadedResources)),this.waitingResources=difference$1(this.waitingResources,this.pendingResources),loadResources(this.pendingResources)},e.prototype.getStatus=function(){return{waiting:this.waitingResources,pending:this.pendingResources,loaded:this.loadedResources}},e.prototype.bindEvents=function(){document.addEventListener(EVENTS.RESOURCE_LOADED,this.onResourceLoaded.bind(this)),document.addEventListener(this.options.readyEvent,this.onReady.bind(this))},e.prototype.onResourceLoaded=function(e){var n=e.detail.resource,t=this.options.handler.map(function(e){return[e.match,e.handle]});cond$1(t)(e.detail),this.loadedResources.push(n);var r=getReadyResources(this.waitingResources,this.loadedResources);if(this.pendingResources=remove$1(this.pendingResources.indexOf(n),1,this.pendingResources).concat(r),this.waitingResources=difference$1(this.waitingResources,this.pendingResources),loadResources(r),isEmpty(this.waitingResources)&&isEmpty(this.pendingResources)){var o=new CustomEvent(this.options.readyEvent);document.dispatchEvent(o)}},e.prototype.onReady=function(){console.log("all resources loaded")},e.prototype.update=function(e){this.init(__assign({},this.options,{container:e}))},e}();window.ResourceLoader=ResourceLoader,exports.ResourceLoader=ResourceLoader,exports.default=ResourceLoader,Object.defineProperty(exports,"__esModule",{value:!0})});
