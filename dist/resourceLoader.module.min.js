!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t():"function"==typeof define&&define.amd?define(t):t()}(0,function(){"use strict";const EVENTS={RESOURCE_LOADED:"RESOURCE_LOADED",COMPONENT_READY:"COMPONENT_READY"},getResourceElements=(e=document)=>[].slice.call(e.querySelectorAll("[data-resources]")),pipe=(...e)=>t=>e.reduce((e,t)=>t(e),t),curry=e=>(...t)=>{if(0===t.length)throw Error("EMPTY INVOCATION");return t.length>=e.length?e(...t):curry(e.bind(null,...t))},defaultTo=(e,t)=>t||e;var defaultTo$1=curry(defaultTo);const prop=(e,t)=>t[e];var prop$1=curry(prop);const getDataResourceFromElement=pipe(defaultTo$1(document.createElement("div")),prop$1("dataset"),prop$1("resources"),defaultTo$1("")),getComponentQueueFromElement=(element=document.createElement("div"))=>{const dataResources=getDataResourceFromElement(element),definitions=eval(dataResources)||[];return definitions.map(e=>Object.assign({},e,{element:element}))},unnest=e=>[].concat.apply([],e),getContentDefinitionsFromDOM=(e=document)=>{const t=getResourceElements(e);return unnest(t.map(getComponentQueueFromElement))},unique=e=>e.filter((e,t,n)=>n.indexOf(e)===t),mergeResources=(e=[])=>e.reduce((t,n)=>-1!==t.map(e=>e.path).indexOf(n.path)?t:[...t,Object.assign({},n,{dependencyPaths:unique(unnest(e.filter(e=>e.path===n.path).map(e=>e.dependencyPaths||[]))),elements:unique(unnest(e.filter(e=>e.path===n.path).map(e=>e.elements||[])))})],[]),resolveBaseWith=(e,t)=>"##"!==t.substring(0,2)?t:e[t]||"";var resolveBaseWith$1=curry(resolveBaseWith);const isAbsolute=e=>new RegExp("^(?:[a-z]+:)?//","i").test(e),isRootPath=e=>0===e.indexOf("/")&&0!==e.indexOf("//"),getTrailingSlashesRegex=()=>/\/?$/,getLeadingSlashesRegex=()=>/^\/?/,replace=(e,t,n)=>n.replace(e,t);var replace$1=curry(replace);const ensureTrailingSlash=replace$1(getTrailingSlashesRegex(),"/"),ensureNoLeadingSlash=replace$1(getLeadingSlashesRegex(),""),identity=e=>e,concat=(e,t)=>e+t;var concat$1=curry(concat);const always=()=>!0,max=(e,t)=>t>e?t:e,_arity=(e,t)=>{switch(e){case 0:return function(){return t.apply(this,arguments)};case 1:return function(e){return t.apply(this,arguments)};case 2:return function(e,n){return t.apply(this,arguments)};case 3:return function(e,n,s){return t.apply(this,arguments)};case 4:return function(e,n,s,r){return t.apply(this,arguments)};case 5:return function(e,n,s,r,o){return t.apply(this,arguments)};case 6:return function(e,n,s,r,o,a){return t.apply(this,arguments)};case 7:return function(e,n,s,r,o,a,i){return t.apply(this,arguments)};case 8:return function(e,n,s,r,o,a,i,c){return t.apply(this,arguments)};case 9:return function(e,n,s,r,o,a,i,c,u){return t.apply(this,arguments)};case 10:return function(e,n,s,r,o,a,i,c,u,d){return t.apply(this,arguments)};default:throw new Error("First argument to _arity must be a non-negative integer no greater than ten")}},cond=e=>{const t=e.map(e=>e[0].length).reduce(max,0);return _arity(t,function(){for(var t=0;t<e.length;){if(e[t][0].apply(this,arguments))return e[t][1].apply(this,arguments);t+=1}})};var cond$1=curry(cond);const defaultToEmptyString=defaultTo$1(""),ensureAbsolutePath=e=>cond$1([[isAbsolute,identity],[isRootPath,pipe(ensureNoLeadingSlash,concat$1(ensureTrailingSlash(e.origin)))],[always,pipe(ensureNoLeadingSlash,concat$1(ensureTrailingSlash(e.href)))]]),createEnsureAbsolutePath=e=>pipe(defaultToEmptyString,ensureAbsolutePath(e)),isRelative=e=>!isAbsolute(e),normalizePath=(e="",t,n)=>{if(t&&n&&isRelative(e)){if(t.base){const s=resolveBaseWith$1(n.baseMap);return createEnsureAbsolutePath(window.location)(ensureTrailingSlash(s(t.base))+e)}if(n.base){const t=createEnsureAbsolutePath(window.location);return isRootPath(e)?t(e):t(ensureTrailingSlash(n.base)+e)}}return e},toResources=(e,t)=>{if(!t)return[];return[...t.paths.map(n=>({path:normalizePath(n,t,e),dependencyPaths:(t.dependsOn?t.dependsOn:[]).map(n=>normalizePath(n,t,e)),elements:[t.element]})),...(t.dependsOn?t.dependsOn:[]).map(n=>({path:normalizePath(n,t,e),dependencyPaths:[],elements:[t.element]}))]};var toResources$1=curry(toResources);const getResourcesFromContainer=(e,t)=>{const n=getContentDefinitionsFromDOM(t);return mergeResources(unnest(n.map(toResources$1(e))))};var getResourcesFromContainer$1=curry(getResourcesFromContainer);const loadResource=e=>fetch(e.path).then(t=>{const n=new CustomEvent(EVENTS.RESOURCE_LOADED,{detail:{resource:e,response:t}});document.dispatchEvent(n)}),loadResources=e=>e.map(loadResource),getResourceByPath=(e,t)=>e.find(e=>e.path===t),checkIfResolvable=(e=[])=>e.every(t=>t.dependencyPaths.every(t=>!!getResourceByPath(e,t))),getReadyResources=(e=[],t=[])=>e.filter(e=>e.dependencyPaths.every(e=>t.some(t=>t.path===e))),isCss=e=>e.resource.path.indexOf(".css")>-1,onCssLoaded=e=>{const t=document.createElement("link");t.rel="stylesheet",t.href=e.resource.path,document.body.append(t)},cssHandler={match:isCss,handle:onCssLoaded},isJs=e=>e.resource.path.indexOf(".js")>-1,onJsLoaded=e=>{const t=document.createElement("script");t.src=e.resource.path,t.async=!0,document.body.append(t)},jsHandler={match:isJs,handle:onJsLoaded},isEmpty=e=>0===e.length;function _Set(){this._nativeSet="function"==typeof Set?new Set:null,this._items={}}function hasOrAdd(e,t,n){var s=typeof e;switch(s){case"undefined":return!!n._items[s]||(t&&(n._items[s]=!0),!1);case"object":if(null===e)return!!n._items.null||(t&&(n._items.null=!0),!1);default:return(s=Object.prototype.toString.call(e))in n._items?-1!==n._items[s].indexOf(e)||(t&&n._items[s].push(e),!1):(t&&(n._items[s]=[e]),!1)}}_Set.prototype.add=function(e){return!hasOrAdd(e,!0,this)},_Set.prototype.has=function(e){return hasOrAdd(e,!1,this)};const difference=(e,t)=>{const n=[];let s=0;const r=e.length,o=t.length,a=new _Set;for(let e=0;e<o;e++)a.add(t[e]);for(;s<r;)a.add(e[s])&&(n[n.length]=e[s]),s+=1;return n};var difference$1=curry(difference);const remove=(e,t,n)=>[...n].splice(e,t);var remove$1=curry(remove);class ResourceLoader{constructor(e){this.options=null,this.pendingResources=[],this.loadedResources=[],this.defaultOptions={readyEvent:"resourcesReady",handler:[cssHandler,jsHandler]},this.options=Object.assign({container:this.defaultContainer},this.defaultOptions,e),this.bindEvents(),this.init(this.options)}get defaultContainer(){return document.querySelector("body")}init(e){this.waitingResources=[...getResourcesFromContainer$1(e,e.container)],checkIfResolvable(this.waitingResources),this.pendingResources=[...this.pendingResources,...getReadyResources(this.waitingResources,this.loadedResources)],this.waitingResources=difference$1(this.waitingResources,this.pendingResources),loadResources(this.pendingResources)}getStatus(){return{waiting:this.waitingResources,pending:this.pendingResources,loaded:this.loadedResources}}bindEvents(){document.addEventListener(EVENTS.RESOURCE_LOADED,this.onResourceLoaded.bind(this)),document.addEventListener(this.options.readyEvent,this.onReady.bind(this))}onResourceLoaded(e){const t=e.detail.resource,n=this.options.handler.map(e=>[e.match,e.handle]);cond$1(n)(e.detail),this.loadedResources.push(t);const s=getReadyResources(this.waitingResources,this.loadedResources);if(this.pendingResources=[...remove$1(this.pendingResources.indexOf(t),1,this.pendingResources),...s],this.waitingResources=difference$1(this.waitingResources,this.pendingResources),loadResources(s),isEmpty(this.waitingResources)&&isEmpty(this.pendingResources)){const e=new CustomEvent(this.options.readyEvent);document.dispatchEvent(e)}}onReady(){}update(e){this.init(Object.assign({},this.options,{container:e}))}}window.resourceLoader=(e=>{const t={match:e=>e.resource.path.indexOf(".css")>-1,handle:e=>{const t=document.createElement("link");t.rel="stylesheet",t.href=e.resource.path,document.body.append(t)}},n={match:e=>e.resource.path.indexOf(".js")>-1,handle:e=>{const t=document.createElement("script");t.src=e.resource.path,t.async=!0,document.body.append(t)}};new ResourceLoader(Object.assign({},e,{handler:[t,n]}))})});
